{% extends 'Home/base.html' %}
{% load static %}
{% block body %}
<div class="page-wrapper">
  <div class="content container-fluid">
    <!-- Tiêu đề trang -->
    <div class="page-header">
      <div class="row align-items-center">
        <div class="col">
          <h3 class="page-title mb-1">Phê duyệt bảng lương
          </h3>
          <ul class="breadcrumb mb-0">
            <li class="breadcrumb-item">
              <a href="{% url 'finance:dashboard' %}">Tài chính</a>
            </li>
            <li class="breadcrumb-item">
              <a href="{% url 'finance:payroll_list' %}">Bảng lương</a>
            </li>
            <li class="breadcrumb-item active">Phê duyệt</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Thông báo xác nhận -->
    <div class="card card-table mb-4">
      <div class="card-body text-center py-4">
        <i class="fas fa-check-circle text-success mb-3" style="font-size: 4rem;"></i>
        <h4 class="fw-semibold mb-2">Xác nhận phê duyệt bảng lương</h4>
        <p class="text-muted mb-0">
          Sau khi phê duyệt, bảng lương sẽ chuyển sang trạng thái
          <strong>Đã duyệt</strong> và không thể chỉnh sửa được nữa.
        </p>
      </div>
    </div>

    <!-- Thông tin chung -->
    <div class="card card-table mb-4 shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-semibold">
          <i class="fas fa-info-circle me-2"></i>Thông tin chung
        </h5>
        <span
          class="badge
          {% if payroll.status == 'draft' %} bg-secondary
          {% elif payroll.status == 'pending' %} bg-warning text-dark
          {% elif payroll.status == 'approved' %} bg-info
          {% elif payroll.status == 'paid' %} bg-success
          {% else %} bg-danger {% endif %}">
          {{ payroll.get_status_display }}
        </span>
      </div>

      <div class="card-body">
        <div class="row" style="max-height: 500px; overflow-y: auto; overflow-x: auto;">
          <div class="col-md-6 mb-3 mb-md-0">
            <table class="table table-sm table-borderless mb-0">
              <tr><th class="w-40">Mã bảng lương:</th><td><code>{{ payroll.payroll_id }}</code></td></tr>
              <tr><th>Nhân viên:</th><td><strong>{{ payroll.employee.last_name }} {{ payroll.employee.first_name }}</strong></td></tr>
              <tr><th>Mã NV:</th><td>{{ payroll.employee.employee_id }}</td></tr>
              <tr><th>Chức vụ:</th><td>{{ payroll.employee.get_position_display }}</td></tr>
            </table>
          </div>
          <div class="col-md-6">
            <table class="table table-sm table-borderless mb-0">
              <tr>
                <th class="w-40">Kỳ lương:</th>
                <td>{{ payroll.start_date|date:"d/m/Y" }} - {{ payroll.end_date|date:"d/m/Y" }}</td>
              </tr>
              <tr><th>Ngày lập:</th><td>{{ payroll.created_at|date:"d/m/Y H:i" }}</td></tr>
              {% if payroll.approved_by %}
              <tr><th>Ngày duyệt:</th><td>{{ payroll.approved_at|date:"d/m/Y H:i" }}</td></tr>
              {% endif %}
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Chi tiết tính lương -->
    <div class="card card-table mb-4 shadow-sm">
      <div class="card-header bg-light">
        <h5 class="mb-0 fw-semibold">
          <i class="fas fa-calculator me-2"></i>Chi tiết tính lương
        </h5>
      </div>
      <div class="card-body p-0">
        <table class="table table-bordered align-middle mb-0">
          <tbody>
            <tr>
              <th class="w-50">Tổng giờ làm việc</th>
              <td class="text-end"><strong>{{ payroll.total_hours }} giờ</strong></td>
            </tr>
            <tr>
              <th>Lương theo giờ</th>
              <td class="text-end">{{ payroll.hourly_rate|floatformat:0 }} VND</td>
            </tr>
            <tr class="table-light">
              <th>Tiền công cơ bản</th>
              <td class="text-end">
                {{ payroll.base_salary|floatformat:0 }} VND<br>
                <small class="text-muted">({{ payroll.total_hours }}h × {{ payroll.hourly_rate|floatformat:0 }})</small>
              </td>
            </tr>
            <tr class="text-success">
              <th>Tiền thưởng</th>
              <td class="text-end fw-semibold">+ {{ payroll.bonus|floatformat:0 }} VND</td>
            </tr>
            <tr class="text-danger">
              <th>Tiền ứng trước</th>
              <td class="text-end fw-semibold">- {{ payroll.advance|floatformat:0 }} VND</td>
            </tr>
            <tr class="text-danger">
              <th>Khấu trừ / Phạt</th>
              <td class="text-end fw-semibold">- {{ payroll.deduction|floatformat:0 }} VND</td>
            </tr>
            <tr class="table-success">
              <th class="fw-bold fs-6">LƯƠNG THỰC NHẬN</th>
              <td class="text-end">
                <strong class="text-success" style="font-size: 1.4rem;">
                  {{ payroll.net_salary|floatformat:0 }} VND
                </strong>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Ghi chú -->
    {% if payroll.notes %}
    <div class="alert alert-info border-0 mb-4">
      <strong><i class="fas fa-info-circle me-2"></i>Ghi chú:</strong> {{ payroll.notes }}
    </div>
    {% endif %}

    <!-- Cảnh báo -->
    <div class="alert alert-warning border-0 mb-4">
      <div class="d-flex align-items-start">
        <i class="fas fa-exclamation-triangle me-3 mt-1" style="font-size: 1.2rem;"></i>
        <div>
          <strong>Lưu ý:</strong>
          <ul class="mb-0 ps-3 mt-2">
            <li>Sau khi phê duyệt, bảng lương sẽ không thể chỉnh sửa hoặc xóa.</li>
            <li>Vui lòng kiểm tra kỹ thông tin trước khi xác nhận.</li>
            <li>Bạn có thể quay lại để xem lại chi tiết chấm công.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Form xác nhận -->
    <div class="card card-table mb-4 shadow-sm">
      <div class="card-body text-center">
        <form method="post">
          {% csrf_token %}
          <a href="{% url 'finance:payroll_detail' payroll.pk %}" class="btn btn-secondary me-2">
            <i class="fas fa-arrow-left me-1"></i> Quay lại
          </a>
          <button type="submit" class="btn btn-success px-4">
            <i class="fas fa-check me-1"></i> Xác nhận phê duyệt
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-center text-muted small mt-3 mb-2">
    <p class="mb-0">© Bản quyền thuộc về Đá Cuội</p>
  </footer>
</div>

<!-- JS -->
<script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
{% endblock %}
